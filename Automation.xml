<project name="AutomationTesting" basedir="." default="RunAutomation">
	<import file="test.common.xml" />

	<!--RunAutomation is main target,it call other target to run-->
	<target name="RunAutomation"> 
		<echo message="OSName: ${JenkinsEnv.COMPUTERNAME}"/>
		<echo message="Job WorkSpace: ${JobWorkSpace.dir}"/>
		<!--TestOutput-->
		<echo message="Branch=${BRANCH}"/>
		<echo message="Installer=${FILE_INSTALLER}"/>
		<echo message="AutomationVM=${AutomationVM}"/>
		<echo message="TestTool=${Automation.TestExecutable}"/>
		<echo message="LocalProjectPath=${AutomationVM.Automation.dir}"/>
		<echo message="RemoteProjectPath=${AutomationVM.Project.dir}"/>

		<antcall target="InitJenkinsServerJobWorkSpace"/>
		<antcallback target="GetInstallerFileName" return="InstallerFileName"/>
		<antcall target="SetBuildDisplayName"> <param name="InstallerFileName" value="${InstallerFileName}"/> </antcall>
		<if>
			<not>
				<equals arg1="${StartVMToPrebuild}" arg2="false"/>
			</not>
			<then>
				<antcall target="StartVMToPrebuild"/>
			</then>
		</if>
		<antcall target="CopyAutomationFilesToVM"> <param name="InstallerFileName" value="${InstallerFileName}"/> </antcall>
		<antcall target="RunTestCasesOnVM"/>
		<antcall target="ProcessTestCasesResults"/>
		<if>
			<not>
				<equals arg1="${PowerOffVM}" arg2="false"/>
			</not>
			<then>
				<antcall target="PowerOffVM"/>
			</then>
			<else>
				<antcall target="DeleteAutomationFilesOnVM"/>
			</else>
		</if>
	</target>
</project>